<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI for the Modern Auto Detailing Shop</title>
    <style>
        :root {
            --primary-color: #007bff; /* Detailing Blue */
            --primary-dark: #0056b3;
            --secondary-color: #6c757d;
            --background-dark: #212529;
            --background-light: #f8f9fa;
            --text-main: #343a40;
            --text-light: #f8f9fa;
            --success: #28a745;
            --danger: #dc3545;
            --border-color: #dee2e6;
            --card-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background-light);
            color: var(--text-main);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar Styles */
        #sidebar {
            width: 300px;
            background-color: var(--background-dark);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            border-right: 1px solid #444;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #444;
            background-color: #1a1e21;
        }

        .sidebar-header h1 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .course-progress {
            font-size: 0.85rem;
            color: #adb5bd;
            margin-top: 10px;
        }

        .progress-bar-container {
            height: 6px;
            background-color: #444;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        #module-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
            list-style: none;
        }

        .module-item {
            padding: 15px 20px;
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: background 0.2s, border-left-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .module-item:hover {
            background-color: #343a40;
        }

        .module-item.active {
            background-color: #2c3034;
            border-left-color: var(--primary-color);
        }

        .module-item.completed .status-icon {
            color: var(--success);
        }

        .status-icon {
            font-size: 1.2rem;
            color: #666;
        }

        /* Main Content Styles */
        #main-content {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            position: relative;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding-bottom: 60px;
        }

        /* Module Components */
        .hero-section {
            background: linear-gradient(135deg, #1e2226 0%, #2c3034 100%);
            color: white;
            padding: 40px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .hero-placeholder {
            width: 120px;
            height: 120px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .module-meta {
            margin-bottom: 20px;
            color: var(--secondary-color);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-block {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--background-dark);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        .objectives-list {
            list-style-position: inside;
            line-height: 1.6;
            color: #555;
        }
        
        .objectives-list li {
            margin-bottom: 8px;
        }

        /* Prompt Comparator */
        .prompt-box {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 15px;
        }

        .prompt-tabs {
            display: flex;
            background-color: #f1f3f5;
            border-bottom: 1px solid var(--border-color);
        }

        .prompt-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 600;
            color: var(--secondary-color);
            transition: all 0.2s;
        }

        .prompt-tab:hover {
            color: var(--primary-color);
        }

        .prompt-tab.active {
            background: white;
            color: var(--primary-color);
            border-top: 2px solid var(--primary-color);
        }

        .prompt-content {
            padding: 20px;
            background: #fafafa;
            font-family: monospace;
            font-size: 1rem;
            color: #333;
            min-height: 80px;
            white-space: pre-wrap;
        }

        /* Activity Section */
        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: inherit;
            margin-bottom: 10px;
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }

        /* Quiz Styles */
        .quiz-question {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px dashed var(--border-color);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover:not(.disabled) {
            border-color: #adb5bd;
            background-color: #f8f9fa;
        }

        .quiz-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 123, 255, 0.05);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background-color: rgba(40, 167, 69, 0.1);
        }

        .quiz-option.incorrect {
            border-color: var(--danger);
            background-color: rgba(220, 53, 69, 0.1);
        }

        .feedback-msg {
            margin-top: 10px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .feedback-msg.correct { color: var(--success); }
        .feedback-msg.incorrect { color: var(--danger); }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--secondary-color);
            color: var(--secondary-color);
        }

        .btn-outline:hover {
            border-color: var(--text-main);
            color: var(--text-main);
        }

        /* Utilities */
        .hidden { display: none; }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 0.75rem;
            border-radius: 4px;
            background-color: #e9ecef;
            color: #495057;
            font-weight: 600;
            margin-right: 5px;
        }
        
        .alert-box {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }
        .alert-info { background-color: #e2e3e5; border-color: #383d41; }
        .alert-warning { background-color: #fff3cd; border-color: #ffc107; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body { flex-direction: column; height: auto; overflow: auto; }
            #sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid #444; }
            #module-list { display: none; } /* Could add toggle for mobile */
            #module-list.show { display: block; }
            #main-content { padding: 20px; }
            .hero-section { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>

    <div id="sidebar">
        <div class="sidebar-header">
            <h1>AI Detailing Course</h1>
            <div class="course-progress">
                Course Progress: <span id="progress-percent">0%</span>
                <div class="progress-bar-container">
                    <div id="progress-bar-fill" class="progress-bar-fill"></div>
                </div>
            </div>
        </div>
        <ul id="module-list">
            <!-- Items generated by JS -->
        </ul>
        <div style="padding: 15px; font-size: 0.8rem; color: #666; text-align: center;">
            <p>Progress auto-saves locally.</p>
        </div>
    </div>

    <div id="main-content">
        <div id="content-area" class="container">
            <!-- Content generated by JS -->
        </div>
    </div>

<script>
/**
 * COURSE DATA
 * Extracted from markdown content
 */
const COURSE_DATA = {
    metadata: {
        title: "AI for the Modern Auto Detailing Shop",
        audience: "Automotive detailing shop owners, managers, technicians, and marketers.",
        modules_count: 5
    },
    modules: [
        {
            id: "module-1",
            title: "Module 1: What is AI & How Can It Help?",
            duration: "45-60 min",
            objectives: [
                "Explain 'AI' in the context of a detailing business.",
                "Identify 3 practical uses for AI in marketing, operations, and in the bay.",
                "Name two key strengths and two major limitations of AI."
            ],
            content: "\n                <h3>Definition</h3>\n                <p><strong>AI</strong> = software that helps with tasks that usually require human thinking. For a detailing shop, this means drafting emails, creating social media posts, brainstorming service ideas, or even getting quick tips for a tough cleaning job.</p>\n                <br>\n                <h3>Everyday Shop Examples</h3>\n                <ul>\n                    <li><strong>Front Office (Marketing):</strong> Generating 5 different Instagram post ideas for a \"before and after\" of an interior shampoo.</li>\n                    <li><strong>Back Office (Operations):</strong> Drafting a polite text message to remind a customer about their appointment tomorrow.</li>\n                    <li><strong>The Bay (Shop Work):</strong> Asking for a quick list of possible causes for swirl marks when polishing a dark-colored car.</li>\n                </ul>\n                <br>\n                <h3>Strengths vs. Limitations</h3>\n                <div class=\"alert-box alert-info\">\n                    <strong>Strengths:</strong> Incredibly fast at generating marketing drafts; great for summarizing long articles; can brainstorm 20 service names in 10 seconds.\n                </div>\n                <div class=\"alert-box alert-warning\">\n                    <strong>Limitations:</strong> Can invent facts (\"hallucinate\"). <strong>ALWAYS verify technical advice with manufacturer guidelines and SDS.</strong>\n                </div>\n            ",
            activity: {
                title: "Think & Share",
                instruction: "List one task from each area of your business (Front Office, Back Office, The Bay) that you think AI could help with. For each, note one potential benefit and one potential risk.",
                placeholder: "1. Front Office Task: ...\n2. Back Office Task: ...\n3. The Bay Task: ..."
            },
            prompts: {
                context: "Ask an AI to help you brainstorm marketing ideas.",
                examples: {
                    good: "Give me marketing ideas.",
                    better: "Give me marketing ideas for my car detailing business.",
                    best: "You are a marketing expert for a high-end auto detailing shop. Generate 5 catchy Instagram post captions for a ceramic coating service. The target audience is luxury car owners. Include relevant hashtags."
                }
            },
            quiz: [
                {id:"q1", type:"mcq", question:"Which task is a good use of AI for your shop's marketing?", choices:["Washing a car","Designing a new logo concept","Ordering soap"], answer:1},
                {id:"q2", type:"mcq", question:"What is a major limitation of using AI for technical bay work?", choices:["It works too fast","It can provide incorrect or dangerous advice","It can't lift heavy equipment"], answer:1},
                {id:"q3", type:"mcq", question:"When AI invents a plausible but false 'fact', like saying a harsh chemical is safe on all paint, this is called:", choices:["A hallucination","A feature","A summary"], answer:0},
                {id:"q4", type:"truefalse", question:"You should always trust an AI's advice on chemical mixtures without double-checking.", choices:["True", "False"], answer:1}, // 1 is False (index)
                {id:"q5", type:"mcq", question:"A good safety habit when using AI is:", choices:["Pasting a customer's credit card number","Verifying important facts and technical advice","Sharing your shop's alarm code to get better security tips"], answer:1}
            ]
        },
        {
            id: "module-2",
            title: "Module 2: Access & Safety",
            duration: "35-45 min",
            objectives: [
                "Identify common ways to access AI tools.",
                "Set up a basic account on a consumer AI service.",
                "Apply a simple privacy checklist for your detailing business."
            ],
            content: "\n                <h3>Where to find AI</h3>\n                <ul>\n                    <li><strong>Web chat:</strong> Visit a site like ChatGPT, Gemini, or Claude.</li>\n                    <li><strong>Mobile apps:</strong> Official apps for on-the-go ideas.</li>\n                    <li><strong>Integrated tools:</strong> Look for AI features in your existing email or booking software.</li>\n                </ul>\n                <br>\n                <h3>Quick Safety Checklist</h3>\n                <div class=\"alert-box alert-warning\">\n                    <strong>NEVER paste sensitive customer or business data.</strong> (Names, addresses, CC info, etc.)\n                </div>\n                <ul>\n                    <li>Use 2FA to secure your AI accounts.</li>\n                    <li>Read privacy terms; understand if your data trains the model.</li>\n                    <li>Always test with non-sensitive, generic sample data first.</li>\n                </ul>\n            ",
            activity: {
                title: "Guided Sandbox: Review Response",
                instruction: "Draft a response to this review: 'My car looks amazing, but the inside still smells a bit like the cleaning products.' Use the 'Best' prompt below. Paste the AI's draft here and add one sentence on how you would edit it.",
                placeholder: "AI Draft: ...\n\nMy Edit: ..."
            },
            prompts: {
                context: "Draft a reply to the sample customer review.",
                examples: {
                    good: "Reply to this review: \"My car looks amazing, but the inside still smells a bit like the cleaning products.\"",
                    better: "Write a friendly and professional reply to this customer review.",
                    best: "You are a customer service manager for a premium detailing shop. Draft a 3-sentence reply to this review: \"My car looks amazing, but the inside still smells a bit like the cleaning products.\" Acknowledge the positive feedback, address the smell, and offer a solution, like suggesting the smell will fade in a day or they can swing by for a quick ozone treatment."
                }
            },
            quiz: [
                {id:"q1", type:"mcq", question:"Which is safest to paste into a public AI chat?", choices:["A list of your customers' phone numbers","A public blog post about a new car wax","Your shop's bank account login"], answer:1},
                {id:"q2", type:"truefalse", question:"It is always safe to upload a CSV file with all your customer names and addresses to a free public AI tool.", choices:["True", "False"], answer:1},
                {id:"q3", type:"mcq", question:"When testing a new AI tool, the best practice is to use:", choices:["Your top client's personal information","Non-sensitive sample data, like generic car models","Your employee's home addresses"], answer:1}
            ]
        },
        {
            id: "module-3",
            title: "Module 3: Putting AI to Work",
            duration: "60-75 min",
            objectives: [
                "Use AI for drafting, summarizing, and brainstorming.",
                "Apply Good/Better/Best prompting patterns.",
                "Edit and verify AI-generated content."
            ],
            content: "\n                <h3>Mini-project Options (Choose Two)</h3>\n                <ol>\n                    <li><strong>Front Office:</strong> Draft a 150-word email to a corporate client.</li>\n                    <li><strong>Back Office:</strong> Summarize a long article about booking software.</li>\n                    <li><strong>The Bay:</strong> Generate a 10-step checklist for a trainee interior detail.</li>\n                </ol>\n                <br>\n                <h3>Editing & Verification Checklist</h3>\n                <ul>\n                    <li><strong>Facts:</strong> Check service names, prices, and numbers.</li>\n                    <li><strong>Technical Steps:</strong> CRITICAL: Verify chemical/tool instructions against manufacturer labels.</li>\n                    <li><strong>Tone:</strong> Adjust language to match your brand voice.</li>\n                    <li><strong>Sensitive Info:</strong> Remove placeholders or personal data.</li>\n                </ul>\n            ",
            activity: {
                title: "Mini-Project Submission",
                instruction: "For your chosen mini-project: Paste the final prompt, the AI's raw output, and your FINAL edited version.",
                placeholder: "Prompt Used: ...\n\nAI Output: ...\n\nFinal Edited Version: ..."
            },
            prompts: {
                context: "Create a step-by-step guide for a technical task.",
                examples: {
                    good: "how to use a clay bar",
                    better: "Write out the steps for using a clay bar on a car.",
                    best: "You are a master detailer writing a standard operating procedure (SOP). Create a safe, step-by-step guide for using a clay bar on a painted car surface for a new employee. Include a \"What You'll Need\" section and a \"Key Mistakes to Avoid\" section with at least 3 points."
                }
            },
            quiz: [
                {id:"q1", type:"mcq", question:"Before you use an AI-drafted email for your business, you should:", choices:["Send it immediately","Edit and verify it for tone, accuracy, and pricing","Delete it and write it from scratch"], answer:1},
                {id:"q2", type:"mcq", question:"A helpful prompt for a clear technical guide includes:", choices:["No context","Context + task + constraints","Only the word 'Explain'"], answer:1},
                {id:"q3", type:"truefalse", question:"You should accept the first output from an AI as the final, perfect version.", choices:["True", "False"], answer:1},
                {id:"q4", type:"mcq", question:"A critical verification step for a bay-related AI output is:", choices:["Checking chemical dilution ratios against the label","Assuming the AI is correct","Asking the AI to repeat itself"], answer:0}
            ]
        },
        {
            id: "module-4",
            title: "Module 4: Advanced Uses & Ethics",
            duration: "60-90 min",
            objectives: [
                "Explore creative and analytical use cases.",
                "Understand ethical concerns.",
                "Draft a simple automation plan."
            ],
            content: "\n                <h3>Ethics & Compliance</h3>\n                <ul>\n                    <li><strong>Photo Consent:</strong> Don't generate fake images of customer cars or pass off AI art as your work without transparency.</li>\n                    <li><strong>Data Privacy:</strong> Use anonymized data for analysis.</li>\n                    <li><strong>Human Review:</strong> Always review important decisions, especially quotes or complaint responses.</li>\n                </ul>\n            ",
            activity: {
                title: "Exploratory Lab",
                instruction: "Choose one: Creative Lab (Ad Copy), Automation Lab (Workflow), or Data Insight Lab. Describe your result here.",
                placeholder: "Lab Chosen: ...\n\nResults/Plan: ..."
            },
            prompts: {
                context: "A social media post about a finished car.",
                examples: {
                    good: "Write a post about this car.",
                    better: "Write a social media post for a freshly detailed black BMW. Mention ceramic coating.",
                    best: "You are a social media manager for a luxury car detailing business. Write an engaging Instagram post about a black BMW M5 that just received our 5-year ceramic coating. Focus on the mirror-like shine and hydrophobic properties. Include a question to engage followers. Add 5 relevant hashtags."
                }
            },
            quiz: [
                {id:"q1", type:"mcq", question:"Before analyzing your shop's sales data with a public AI tool, you should:", choices:["Upload your entire QuickBooks file","Use enterprise-approved AI or anonymized sample data","Don't worry about it"], answer:1},
                {id:"q2", type:"truefalse", question:"It is ethical to use an AI image generator to create a cool picture of a generic sports car for your ads.", choices:["True", "False"], answer:0}, // 0 is True
                {id:"q3", type:"mcq", question:"A good automation practice is to:", choices:["Fully automate everything","Test in sandbox and add human review steps","Deploy immediately"], answer:1}
            ]
        },
        {
            id: "module-5",
            title: "Module 5: Next Steps",
            duration: "30-45 min",
            objectives: [
                "Build a 30-day personal AI practice plan.",
                "Recognize basic prompt engineering patterns (R.C.T.F).",
                "Choose your next learning steps."
            ],
            content: "\n                <h3>Prompt Patterns (R.C.T.F)</h3>\n                <ul>\n                    <li><strong>R</strong>ole: \"You are a [role]...\"</li>\n                    <li><strong>C</strong>ontext: \"Here is the background...\"</li>\n                    <li><strong>T</strong>ask + Constraints: \"Your job is to...\"</li>\n                    <li><strong>F</strong>ormat: \"Return the output as...\"</li>\n                </ul>\n                <br>\n                <h3>Final Project</h3>\n                <p>Choose either the <strong>Operations Efficiency Package</strong> or the <strong>Mini-Marketing Campaign</strong> to apply what you've learned.</p>\n            ",
            activity: {
                title: "Final Project Submission",
                instruction: "Paste your Final Project components here (Problem Statement/Service, Prompt History, Final Output, Reflection).",
                placeholder: "Project Choice: ...\n\nDetails: ..."
            },
            prompts: {
                context: "N/A - Review R.C.T.F. method above.",
                examples: {
                    good: "N/A",
                    better: "N/A",
                    best: "N/A"
                }
            },
            quiz: [
                {id:"q1", type:"mcq", question:"Which prompt pattern helps the AI understand its perspective?", choices:["Role","Random words","No pattern"], answer:0},
                {id:"q2", type:"mcq", question:"A good next step after this course is to:", choices:["Try to automate one small, repetitive task","Stop using AI","Upload financial records to public AI"], answer:0}
            ]
        }
    ]
};

/**
 * APP LOGIC
 */
const App = {
    state: {
        activeModuleIndex: 0,
        completedModules: [],
        quizScores: {}, // { moduleId: { qId: correctBool } }
        activityData: {} // { moduleId: string }
    },

    init() {
        this.loadState();
        this.renderSidebar();
        this.renderModule(this.state.activeModuleIndex);
        this.updateProgress();
    },

    loadState() {
        try {
            const saved = localStorage.getItem('aiCourseState');
            if (saved) {
                this.state = JSON.parse(saved);
            }
        } catch (e) {
            console.warn("LocalStorage access denied or error. State will not persist.");
        }
    },

    saveState() {
        try {
            localStorage.setItem('aiCourseState', JSON.stringify(this.state));
            this.updateProgress();
            this.renderSidebar(); // Re-render to show checkmarks
        } catch (e) {
            console.warn("Could not save state.");
        }
    },

    updateProgress() {
        const totalModules = COURSE_DATA.modules.length;
        const completedCount = this.state.completedModules.length;
        const percent = Math.round((completedCount / totalModules) * 100);
        
        document.getElementById('progress-percent').textContent = `${percent}%`;
        document.getElementById('progress-bar-fill').style.width = `${percent}%`;
    },

    renderSidebar() {
        const list = document.getElementById('module-list');
        list.innerHTML = '';
        
        COURSE_DATA.modules.forEach((mod, index) => {
            const li = document.createElement('li');
            li.className = `module-item ${index === this.state.activeModuleIndex ? 'active' : ''} ${this.state.completedModules.includes(mod.id) ? 'completed' : ''}`;
            
            const isCompleted = this.state.completedModules.includes(mod.id);
            const icon = isCompleted ? 'âœ“' : (index + 1);
            
            li.innerHTML = `
                <span>Module ${index + 1}</span>
                <span class="status-icon">${icon}</span>
            `;
            li.onclick = () => {
                this.state.activeModuleIndex = index;
                this.renderSidebar();
                this.renderModule(index);
            };
            list.appendChild(li);
        });
    },

    renderModule(index) {
        const mod = COURSE_DATA.modules[index];
        const container = document.getElementById('content-area');
        
        // Scroll to top
        document.getElementById('main-content').scrollTop = 0;

        let html = `
            <div class="hero-section">
                <div class="hero-placeholder">ðŸš—</div>
                <div>
                    <div class="module-meta">Module ${index + 1} â€¢ ${mod.duration}</div>
                    <h1 style="margin-bottom:10px;">${mod.title.split(': ')[1]}</h1>
                </div>
            </div>

            <div class="section-block">
                <h2 class="section-title">Learning Objectives</h2>
                <ul class="objectives-list">
                    ${mod.objectives.map(obj => `<li>${obj}</li>`).join('')}
                </ul>
            </div>

            <div class="section-block">
                <h2 class="section-title">Core Content</h2>
                ${mod.content}
            </div>
        `;

        // Prompt Practice Section (if available)
        if (mod.prompts && mod.prompts.examples.good !== "N/A") {
            html += `
                <div class="section-block">
                    <h2 class="section-title">Prompt Practice: Good / Better / Best</h2>
                    <p><strong>Context:</strong> ${mod.prompts.context}</p>
                    <div class="prompt-box">
                        <div class="prompt-tabs">
                            <button class="prompt-tab" onclick="App.switchPrompt(this, 'good')">Good</button>
                            <button class="prompt-tab" onclick="App.switchPrompt(this, 'better')">Better</button>
                            <button class="prompt-tab active" onclick="App.switchPrompt(this, 'best')">Best</button>
                        </div>
                        <div class="prompt-content" id="active-prompt-content">${mod.prompts.examples.best}</div>
                        <!-- Hidden storage for JS toggling -->
                        <div id="prompt-data" style="display:none;" 
                            data-good="${this.escapeHtml(mod.prompts.examples.good)}"
                            data-better="${this.escapeHtml(mod.prompts.examples.better)}"
                            data-best="${this.escapeHtml(mod.prompts.examples.best)}">
                        </div>
                    </div>
                </div>
            `;
        }

        // Activity Section
        if (mod.activity) {
            const savedActivity = this.state.activityData[mod.id] || "";
            html += `
                <div class="section-block">
                    <h2 class="section-title">Activity: ${mod.activity.title}</h2>
                    <p style="margin-bottom:15px;">${mod.activity.instruction}</p>
                    <textarea id="activity-input" placeholder="${mod.activity.placeholder}">${savedActivity}</textarea>
                    <button class="btn btn-primary" onclick="App.saveActivity('${mod.id}')">Save Entry</button>
                    <span id="activity-msg" style="margin-left:10px; color:var(--success); display:none;">Saved!</span>
                </div>
            `;
        }

        // Quiz Section
        if (mod.quiz && mod.quiz.length > 0) {
            html += `<div class="section-block"><h2 class="section-title">Module Quiz</h2>`;
            
            const savedScores = this.state.quizScores[mod.id] || {};
            const isModuleComplete = this.state.completedModules.includes(mod.id);

            mod.quiz.forEach((q, qIndex) => {
                const isCorrect = savedScores[q.id];
                const hasAnswered = savedScores.hasOwnProperty(q.id);
                
                html += `
                    <div class="quiz-question" id="q-container-${q.id}">
                        <div class="question-text">${qIndex + 1}. ${q.question}</div>
                        <div class="quiz-options">
                            ${q.choices.map((choice, cIndex) => `
                                <div class="quiz-option ${hasAnswered && cIndex === q.answer ? 'correct' : ''} ${hasAnswered && cIndex !== q.answer && savedScores[q.id] === false ? 'disabled' : ''}" 
                                     onclick="App.checkAnswer('${mod.id}', '${q.id}', ${cIndex}, ${q.answer})">
                                    ${choice}
                                </div>
                            `).join('')}
                        </div>
                        <div class="feedback-msg" id="feedback-${q.id}">
                            ${hasAnswered ? (isCorrect ? "Correct!" : "Incorrect, try again.") : ""}
                        </div>
                    </div>
                `;
            });
            html += `</div>`;
        }

        // Navigation
        html += `
            <div class="nav-buttons">
                <button class="btn btn-outline" onclick="App.prevModule()" ${index === 0 ? 'disabled' : ''}>&larr; Previous</button>
                <button class="btn btn-primary" onclick="App.nextModule()">
                    ${index === COURSE_DATA.modules.length - 1 ? 'Finish Course' : 'Next Module &rarr;'}
                </button>
            </div>
        `;

        container.innerHTML = html;
    },

    switchPrompt(btn, type) {
        // Update tabs
        const tabs = btn.parentElement.querySelectorAll('.prompt-tab');
        tabs.forEach(t => t.classList.remove('active'));
        btn.classList.add('active');

        // Update content
        const data = document.getElementById('prompt-data');
        const content = document.getElementById('active-prompt-content');
        content.textContent = data.getAttribute(`data-${type}`);
    },

    escapeHtml(text) {
        if (!text) return "";
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    },

    saveActivity(moduleId) {
        const val = document.getElementById('activity-input').value;
        this.state.activityData[moduleId] = val;
        this.saveState();
        
        const msg = document.getElementById('activity-msg');
        msg.style.display = 'inline';
        setTimeout(() => { msg.style.display = 'none'; }, 2000);
    },

    checkAnswer(moduleId, qId, selectedIndex, correctIndex) {
        const isCorrect = selectedIndex === correctIndex;
        
        // Save score
        if (!this.state.quizScores[moduleId]) this.state.quizScores[moduleId] = {};
        this.state.quizScores[moduleId][qId] = isCorrect;
        
        // Visual Feedback
        const container = document.getElementById(`q-container-${qId}`);
        const options = container.querySelectorAll('.quiz-option');
        const feedback = document.getElementById(`feedback-${qId}`);

        options.forEach((opt, idx) => {
            opt.classList.remove('selected', 'correct', 'incorrect');
            if (idx === selectedIndex) {
                opt.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
            if (isCorrect && idx === selectedIndex) {
                 opt.classList.add('correct');
            }
        });

        feedback.textContent = isCorrect ? "Correct!" : "Incorrect, please try again.";
        feedback.className = `feedback-msg ${isCorrect ? 'correct' : 'incorrect'}`;

        this.checkModuleCompletion(moduleId);
        this.saveState();
    },

    checkModuleCompletion(moduleId) {
        const mod = COURSE_DATA.modules.find(m => m.id === moduleId);
        if (!mod) return;

        const scores = this.state.quizScores[moduleId];
        if (!scores) return;

        // Check if all questions are answered correctly
        const allCorrect = mod.quiz.every(q => scores[q.id] === true);

        if (allCorrect) {
            if (!this.state.completedModules.includes(moduleId)) {
                this.state.completedModules.push(moduleId);
                this.saveState();
            }
        }
    },

    prevModule() {
        if (this.state.activeModuleIndex > 0) {
            this.state.activeModuleIndex--;
            this.init();
        }
    },

    nextModule() {
        // Mark current as complete if it has no quiz, or just manual override
        const currentMod = COURSE_DATA.modules[this.state.activeModuleIndex];
        
        // If module has no quiz, mark complete on next
        if ((!currentMod.quiz || currentMod.quiz.length === 0) && !this.state.completedModules.includes(currentMod.id)) {
            this.state.completedModules.push(currentMod.id);
            this.saveState();
        }

        if (this.state.activeModuleIndex < COURSE_DATA.modules.length - 1) {
            this.state.activeModuleIndex++;
            this.init();
        } else {
            alert("Congratulations! You have completed the course material.");
        }
    }
};

// Start App
window.onload = () => App.init();

</script>
</body>
</html>
